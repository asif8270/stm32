/*
 * adc.c
 *
 *  Created on: Oct 11, 2024
 *      Author: Asif
 */

#include "stm32f4xx.h"
#include "adc.h"

#define ADC1EN		(1U<<8)
#define ADC1ON		(1U<<0)
#define SR_EOC		(1U<<1)

#define GPIOAEN		(1U<<0)

void adcInit(void)
{
	/*Enable clock to GPIOA*/
	RCC->AHB1ENR |= GPIOAEN;

	/*Set PA1 mode as analog*/
	GPIOA->MODER |= (1U<<2);
	GPIOA->MODER |= (1U<<3);

	/*Enable clock to ADC1*/
	RCC->APB2ENR |= ADC1EN;

	/*Start conversion at channel 1*/
	ADC1->SQR3 = 0x1F;

	/*Enable the ADC1*/
	ADC1->CR2 |= ADC1ON;

	/*Start conversion*/
	ADC1->CR2 |= (1U<<30);

	/*Wait for the conversion to be complete*/
	while(!(ADC1->SR & SR_EOC)){};

	/*Return the converted value*/
	return ADC1->DR;
}
